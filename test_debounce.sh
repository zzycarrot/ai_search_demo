#!/bin/bash

# æµ‹è¯•é˜²æŠ–å’Œå»é‡åŠŸèƒ½
echo "ğŸ§ª æµ‹è¯•é˜²æŠ–å’Œå»é‡åŠŸèƒ½"
echo "========================"

# æ¸…ç†ç¯å¢ƒ
rm -rf storage/* docs/*
mkdir -p docs storage

# åˆ›å»ºä¸€ä¸ªè¾ƒå¤§çš„æµ‹è¯•æ–‡ä»¶ï¼ˆæ¨¡æ‹ŸPDFï¼‰
echo "åˆ›å»ºæµ‹è¯•æ–‡ä»¶..."
cat > docs/large_test.txt << 'EOF'
äººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligenceï¼Œç®€ç§°AIï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªé‡è¦åˆ†æ”¯ï¼Œ
å®ƒä¼å›¾äº†è§£æ™ºèƒ½çš„å®è´¨ï¼Œå¹¶ç”Ÿäº§å‡ºä¸€ç§æ–°çš„èƒ½ä»¥äººç±»æ™ºèƒ½ç›¸ä¼¼çš„æ–¹å¼åšå‡ºååº”çš„æ™ºèƒ½æœºå™¨ã€‚
äººå·¥æ™ºèƒ½çš„ç ”ç©¶åŒ…æ‹¬æœºå™¨äººã€è¯­è¨€è¯†åˆ«ã€å›¾åƒè¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†å’Œä¸“å®¶ç³»ç»Ÿç­‰ã€‚

æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„æ ¸å¿ƒï¼Œé€šè¿‡ç®—æ³•è®©è®¡ç®—æœºä»æ•°æ®ä¸­å­¦ä¹ è§„å¾‹ã€‚
æ·±åº¦å­¦ä¹ ä½¿ç”¨ç¥ç»ç½‘ç»œæ¨¡æ‹Ÿäººè„‘å¤„ç†ä¿¡æ¯çš„æ–¹å¼ï¼Œå–å¾—äº†çªç ´æ€§è¿›å±•ã€‚

è‡ªç„¶è¯­è¨€å¤„ç†è®©è®¡ç®—æœºèƒ½å¤Ÿç†è§£å’Œç”Ÿæˆäººç±»è¯­è¨€ï¼Œæ˜¯AIçš„é‡è¦åº”ç”¨é¢†åŸŸã€‚
è®¡ç®—æœºè§†è§‰ä½¿æœºå™¨èƒ½å¤Ÿåƒäººç±»ä¸€æ ·çœ‹æ‡‚å’Œç†è§£å›¾åƒå†…å®¹ã€‚

äººå·¥æ™ºèƒ½çš„å‘å±•ç»å†äº†å¤šæ¬¡èµ·ä¼ï¼Œä½†è¿‘å¹´æ¥éšç€è®¡ç®—èƒ½åŠ›çš„æå‡å’Œå¤§æ•°æ®çš„ç§¯ç´¯ï¼Œ
AIæŠ€æœ¯å–å¾—äº†é•¿è¶³çš„è¿›æ­¥ï¼Œåœ¨å„ä¸ªé¢†åŸŸéƒ½å±•ç°å‡ºäº†å·¨å¤§çš„åº”ç”¨æ½œåŠ›ã€‚
EOF

echo "âœ… æµ‹è¯•æ–‡ä»¶åˆ›å»ºå®Œæˆ"

# å¯åŠ¨ç¨‹åº
echo ""
echo "ğŸš€ å¯åŠ¨ç¨‹åº..."
cargo run &
PROGRAM_PID=$!

# ç­‰å¾…ç¨‹åºæ‰«æåˆå§‹æ–‡ä»¶
sleep 3

echo ""
echo "ğŸ“ æ¨¡æ‹Ÿæ–‡ä»¶ä¿®æ”¹æ“ä½œ..."

# å¿«é€Ÿè¿ç»­ä¿®æ”¹æ–‡ä»¶å¤šæ¬¡ï¼ˆæ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿäº‹ä»¶ï¼‰
for i in {1..3}; do
    echo "ç¬¬$iæ¬¡ä¿®æ”¹: $(date +%H:%M:%S.%3N)" >> docs/large_test.txt
    sleep 0.1  # é—´éš”100ms
done

echo "âœ… æ–‡ä»¶ä¿®æ”¹å®Œæˆ"

# ç­‰å¾…ç¨‹åºå¤„ç†
sleep 5

# æµ‹è¯•æœç´¢
echo ""
echo "ğŸ” æµ‹è¯•æœç´¢åŠŸèƒ½..."
echo "äººå·¥æ™ºèƒ½" > /tmp/search_input
echo "quit" >> /tmp/search_input

# å‘é€æœç´¢å‘½ä»¤ï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
echo "è¯·æ‰‹åŠ¨æµ‹è¯•æœç´¢ï¼Œæˆ–æŸ¥çœ‹ç¨‹åºè¾“å‡ºç¡®è®¤é˜²æŠ–æ˜¯å¦ç”Ÿæ•ˆ"

# ç­‰å¾…ç”¨æˆ·è§‚å¯Ÿ
echo ""
echo "â³ è§‚å¯Ÿç¨‹åºè¾“å‡ºï¼Œç¡®è®¤æ˜¯å¦åªæœ‰æœ€åä¸€æ¬¡ä¿®æ”¹è¢«å¤„ç†"
echo "   å¦‚æœçœ‹åˆ°å¤šæ¬¡ 'æ–°æ–‡ä»¶å·²ç´¢å¼•'ï¼Œè¯´æ˜é˜²æŠ–å¤±è´¥"
echo "   å¦‚æœåªçœ‹åˆ°ä¸€æ¬¡ï¼Œè¯´æ˜é˜²æŠ–æˆåŠŸ"
echo ""
read -p "æŒ‰ Enter é”®åœæ­¢æµ‹è¯•..."

# åœæ­¢ç¨‹åº
kill $PROGRAM_PID 2>/dev/null
wait $PROGRAM_PID 2>/dev/null

echo ""
echo "âœ… æµ‹è¯•å®Œæˆ"